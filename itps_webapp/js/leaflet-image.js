!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).leafletImage=t()}}(function(){return function t(e,n,i){function o(r,s){if(!n[r]){if(!e[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(a)return a(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[r]={exports:{}};e[r][0].call(u.exports,function(t){var n=e[r][1][t];return o(n||t)},u,u.exports,t,e,n,i)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(t,e,n){var i=t("d3-queue").queue,o=+new Date;e.exports=function(t,e){var n=!!L.mapbox,a=t.getSize(),r=new i(1),s=document.createElement("canvas");s.width=a.x,s.height=a.y;var c=s.getContext("2d"),l=document.createElement("canvas");l.width=1,l.height=1;var u=l.getContext("2d");if(u.fillStyle="rgba(0,0,0,0)",u.fillRect(0,0,1,1),t.eachLayer(function(t){t instanceof L.TileLayer?r.defer(d,t):t._heat&&r.defer(h,t._canvas)}),t.eachLayer(function(t){if(!L.esri)return;t instanceof L.esri.DynamicMapLayer&&r.defer(v,t)}),t._pathRoot)r.defer(h,t._pathRoot);else if(t._panes){var f=t._panes.overlayPane.getElementsByTagName("canvas").item(0);f&&r.defer(h,f)}function d(e,o){var r=L.TileLayer.Canvas&&e instanceof L.TileLayer.Canvas,s=document.createElement("canvas");s.width=a.x,s.height=a.y;var c=s.getContext("2d"),u=t.getPixelBounds(),f=t.getZoom(),d=e.options.tileSize;if(f>e.options.maxZoom||f<e.options.minZoom||n&&e instanceof L.mapbox.tileLayer&&!e.options.tiles)return o();var h,_,v=L.bounds(u.min.divideBy(d)._floor(),u.max.divideBy(d)._floor()),m=[],p=new i(1);for(h=v.min.y;h<=v.max.y;h++)for(_=v.min.x;_<=v.max.x;_++)m.push(new L.Point(_,h));function y(t,e,n,i){i(null,{img:t,pos:e,size:n})}function w(t,n,i,o){var a=new Image;a.crossOrigin="",a.onload=function(){o(null,{img:this,pos:n,size:i})},a.onerror=function(t){""!=e.options.errorTileUrl&&void 0===t.target.errorCheck?(t.target.errorCheck=!0,t.target.src=e.options.errorTileUrl):o(null,{img:l,pos:n,size:i})},a.src=t}function x(t){c.drawImage(t.img,Math.floor(t.pos.x),Math.floor(t.pos.y),t.size,t.size)}m.forEach(function(t){var n=t.clone();e._adjustTilePoint&&e._adjustTilePoint(t);var i=n.scaleBy(new L.Point(d,d)).subtract(u.min);if(t.y>=0)if(r){var o=e._tiles[t.x+":"+t.y];p.defer(y,o,i,d)}else{var a=g(e.getTileUrl(t));p.defer(w,a,i,d)}}),p.awaitAll(function(t,e){e.forEach(x),o(null,{canvas:s})})}function h(e,n){var i=t.getPixelBounds(),o=t.getPixelOrigin(),r=document.createElement("canvas");r.width=a.x,r.height=a.y;var s=r.getContext("2d"),c=L.DomUtil.getPosition(e).subtract(i.min).add(o);try{s.drawImage(e,c.x,c.y,r.width-2*c.x,r.height-2*c.y),n(null,{canvas:r})}catch(t){console.error("Element could not be drawn on canvas",e)}}function _(e,n){var i=document.createElement("canvas"),o=i.getContext("2d"),r=t.getPixelBounds(),s=new L.Point(r.min.x,r.min.y),c=t.project(e.getLatLng()),l=/^data\:/.test(e._icon.src),u=l?e._icon.src:g(e._icon.src),f=new Image,d=e.options.icon.options,h=d.iconSize,_=c.subtract(s),v=L.point(d.iconAnchor||h&&h.divideBy(2,!0));h instanceof L.Point&&(h=[h.x,h.y]);var m=Math.round(_.x-h[0]+v.x),p=Math.round(_.y-v.y);i.width=a.x,i.height=a.y,f.crossOrigin="",f.onload=function(){o.drawImage(this,m,p,h[0],h[1]),n(null,{canvas:i})},f.src=u,l&&f.onload()}function v(t,e){var n=document.createElement("canvas");n.width=a.x,n.height=a.y;var i=n.getContext("2d"),o=new Image;o.crossOrigin="",o.src=g(t._currentImage._image.src),o.onload=function(){i.drawImage(o,0,0),e(null,{canvas:n})}}function g(t){return function(t){return!!t.match(/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i)}(t)||-1!==t.indexOf("mapbox.com/styles/v1")?t:t+(t.match(/\?/)?"&":"?")+"cache="+o}t.eachLayer(function(t){t instanceof L.Marker&&t.options.icon instanceof L.Icon&&r.defer(_,t)}),r.awaitAll(function(t,n){if(t)throw t;n.forEach(function(t){t&&t.canvas&&c.drawImage(t.canvas,0,0)}),e(null,s)})}},{"d3-queue":2}],2:[function(t,e,n){var i;i=this,function(t){"use strict";var e=[].slice,n={};function i(t){if(!(t>=1))throw new Error;this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function o(t){if(!t._start)try{!function(t){for(;t._start=t._waiting&&t._active<t._size;){var e=t._ended+t._active,i=t._tasks[e],o=i.length-1,r=i[o];i[o]=a(t,e),--t._waiting,++t._active,i=r.apply(null,i),t._tasks[e]&&(t._tasks[e]=i||n)}}(t)}catch(e){t._tasks[t._ended+t._active-1]&&r(t,e)}}function a(t,e){return function(n,i){t._tasks[e]&&(--t._active,++t._ended,t._tasks[e]=null,null==t._error&&(null!=n?r(t,n):(t._data[e]=i,t._waiting?o(t):s(t))))}}function r(t,e){var n,i=t._tasks.length;for(t._error=e,t._data=void 0,t._waiting=NaN;--i>=0;)if((n=t._tasks[i])&&(t._tasks[i]=null,n.abort))try{n.abort()}catch(e){}t._active=NaN,s(t)}function s(t){!t._active&&t._call&&t._call(t._error,t._data)}function c(t){return new i(arguments.length?+t:1/0)}i.prototype=c.prototype={constructor:i,defer:function(t){if("function"!=typeof t||this._call)throw new Error;if(null!=this._error)return this;var n=e.call(arguments,1);return n.push(t),++this._waiting,this._tasks.push(n),o(this),this},abort:function(){return null==this._error&&r(this,new Error("abort")),this},await:function(t){if("function"!=typeof t||this._call)throw new Error;return this._call=function(e,n){t.apply(null,[e].concat(n))},s(this),this},awaitAll:function(t){if("function"!=typeof t||this._call)throw new Error;return this._call=t,s(this),this}},t.version="2.0.3",t.queue=c}("object"==typeof n&&void 0!==e?n:i.d3_queue=i.d3_queue||{})},{}]},{},[1])(1)});