/**
 * Coded by idsilmat@gmail.com
 * 12.1.2020
 **/
var LAYERS=[],coverage_type=null;const BAGRAS_GEOJSON="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/RescaledRefinedBagras_CaragaRegion.json",MANGIUM_GEOJSON="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/RescaledRefinedMangium_CaragaRegion.json",GMELINA_GEOJSON="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/RescaledRefinedGmelina_CaragaRegion.json",FALCATA_GEOJSON="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/RescaledRefinedFalcata_CaragaRegion.json",BRGY_FALCATA="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Falcata_Stats_BrgyLevel.json",BRGY_GMELINA="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Gmelina_Stats_BrgyLevel.json",BRGY_MANGIUM="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Mangium_Stats_BrgyLevel.json",BRGY_BAGRAS="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Bagras_Stats_BrgyLevel.json",MUN_FALCATA="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Falcata_Stats_MunLevel.json",MUN_GMELINA="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Gmelina_Stats_MunLevel.json",MUN_MANGIUM="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Mangium_Stats_MunLevel.json",MUN_BAGRAS="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Bagras_Stats_MunLevel.json",PROV_FALCATA="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Falcata_Stats_ProvLevel.json",PROV_GMELINA="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Gmelina_Stats_ProvLevel.json",PROV_MANGIUM="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Mangium_Stats_ProvLevel.json",PROV_BAGRAS="https://raw.githubusercontent.com/mattmorz/mattmorz.github.io/master/itps_webapp/data/Bagras_Stats_ProvLevel.json";var map=L.map("map");map.setView([9.1204,125.59],8);var FALCATAtileLayer,BAGRAStileLayer,MANGIUMtileLayer,GMELINAtileLayer,BRGYtileLayer,MUNtileLayer,PROVtileLayer,highlight,treesRepo=L.geoJson(null),brgyRepoFalcata=L.geoJson(null),brgyRepoFalcata1=null,brgyRepoGmelina=L.geoJson(null),brgyRepoGmelina1=null,brgyRepoMangium=L.geoJson(null),brgyRepoMangium1=null,brgyRepoBagras=L.geoJson(null),brgyRepoBagras1=null,munRepoFalcata=L.geoJson(null),munRepoFalcata1=null,munRepoGmelina=L.geoJson(null),munRepoGmelina1=null,munRepoMangium=L.geoJson(null),munRepoMangium1=null,munRepoBagras=L.geoJson(null),munRepoBagras1=null,provRepoFalcata=L.geoJson(null),provRepoFalcata1=null,provRepoGmelina=L.geoJson(null),provRepoGmelina1=null,provRepoMangium=L.geoJson(null),provRepoMangium1=null,provRepoBagras=L.geoJson(null),provRepoBagras1=null,groupAreaStats=new L.layerGroup,groupTrees=new L.layerGroup,toogleFALCATA=!1,toogleBAGRAS=!1,toogleGMELINA=!1,toogleMANGIUM=!1,toogleAreaStats=!1,toogleAreaStatsByBrgy=!1,toogleAreaStatsByMun=!1,toogleAreaStatsByMProv=!1,activeStatsLayer=null,activeTreeName=null,loadedLayers=[];function addFALCATA(){var e;if(0==toogleFALCATA){$("#loadMe").modal("show");var a=omnivore.geojson(FALCATA_GEOJSON);a.on("ready",function(){console.log("ready"),e=a.toGeoJSON(),treesRepo.addData(e),FALCATAtileLayer=L.vectorGrid.slicer(e,{rendererFactory:L.canvas.tile,vectorTileLayerStyles:{sliced:{fillColor:"skyblue",color:"blue",weight:.1,fill:!0,stroke:!0,fillOpacity:.8}},maxZoom:22,indexMaxZoom:5,interactive:!0,getFeatureId:function(e){return e.id}}).addTo(map),toogleFALCATA=!0,console.log("added to map"),groupTrees.addLayer(FALCATAtileLayer),setTimeout(function(){$("#loadMe").modal("hide")},500)})}}function addMANGIUM(){var e;if(0==toogleMANGIUM){$("#loadMe").modal("show");var a=omnivore.geojson(MANGIUM_GEOJSON);a.on("ready",function(){console.log("ready"),e=a.toGeoJSON(),treesRepo.addData(e),MANGIUMtileLayer=L.vectorGrid.slicer(e,{rendererFactory:L.canvas.tile,vectorTileLayerStyles:{sliced:{fillColor:"orange",color:"orange",weight:.1,fill:!0,stroke:!0,fillOpacity:.8}},maxZoom:22,indexMaxZoom:5,interactive:!0,getFeatureId:function(e){return e.id}}).addTo(map),setTimeout(function(){$("#loadMe").modal("hide")},500),console.log("added to map"),groupTrees.addLayer(MANGIUMtileLayer),toogleMANGIUM=!0})}}function addGMELINA(){var e;if(0==toogleGMELINA){$("#loadMe").modal("show");var a=omnivore.geojson(GMELINA_GEOJSON);a.on("ready",function(){console.log("ready"),e=a.toGeoJSON(),treesRepo.addData(e),GMELINAtileLayer=L.vectorGrid.slicer(e,{rendererFactory:L.canvas.tile,vectorTileLayerStyles:{sliced:{fillColor:"red",color:"red",weight:.1,fill:!0,stroke:!0,fillOpacity:.8}},maxZoom:22,indexMaxZoom:5,interactive:!0,getFeatureId:function(e){return e.id}}).addTo(map),console.log("added to map"),groupTrees.addLayer(GMELINAtileLayer),setTimeout(function(){$("#loadMe").modal("hide")},500),toogleGMELINA=!0})}}function addBAGRAS(){var e;if(0==toogleBAGRAS){$("#loadMe").modal("show");var a=omnivore.geojson(BAGRAS_GEOJSON);a.on("ready",function(){console.log("ready"),e=a.toGeoJSON(),treesRepo.addData(e),BAGRAStileLayer=L.vectorGrid.slicer(e,{rendererFactory:L.canvas.tile,loadingControl:!0,vectorTileLayerStyles:{sliced:{fillColor:"green",color:"blue",weight:.1,fill:!0,stroke:!0,fillOpacity:.8}},maxZoom:22,indexMaxZoom:5,interactive:!0,getFeatureId:function(e){return e.id}}).addTo(map),console.log("added to map"),groupTrees.addLayer(BAGRAStileLayer),toogleBAGRAS=!0,setTimeout(function(){$("#loadMe").modal("hide")},500)})}}function addLayerStats(e,a,t){if(0==toogleAreaStats){var o;$("#loadMe").modal("show");var r=omnivore.geojson(e);r.on("ready",function(){console.log("ready"),o=r.toGeoJSON(),"Barangay"==a&&("Barangay_Falcata"==t&&(brgyRepoFalcata.addData(o),brgyRepoFalcata1=o),"Barangay_Gmelina"==t&&(brgyRepoGmelina.addData(o),brgyRepoGmelina1=o),"Barangay_Mangium"==t&&(brgyRepoMangium.addData(o),brgyRepoMangium1=o),"Barangay_Bagras"==t&&(brgyRepoBagras.addData(o),brgyRepoBagras1=o),BRGYtileLayer=L.vectorGrid.slicer(o,{rendererFactory:L.canvas.tile,loadingControl:!0,vectorTileLayerStyles:{sliced:function(e,a){var t=e.Area_sqm;return 0==t?{fillColor:"white",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t<=2e4?{fillColor:"yellow",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t>2e4&&t<=4e4?{fillColor:"orange",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:{fillColor:"red",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}}},maxZoom:22,indexMaxZoom:5,interactive:!0,getFeatureId:function(e){return e.BGY_CODE+"_"+e.MUN_CODE},name:t}).addTo(map),groupAreaStats.addLayer(BRGYtileLayer),toogleAreaStatsByBrgy=!0),"City/Municipality"==a&&("City/Municipality_Falcata"==t&&(munRepoFalcata.addData(o),munRepoFalcata1=o),"City/Municipality_Gmelina"==t&&(munRepoGmelina.addData(o),munRepoGmelina1=o),"City/Municipality_Mangium"==t&&(munRepoMangium.addData(o),munRepoMangium1=o),"City/Municipality_Bagras"==t&&(munRepoBagras.addData(o),munRepoBagras1=o),MUNtileLayer=L.vectorGrid.slicer(o,{rendererFactory:L.canvas.tile,loadingControl:!0,vectorTileLayerStyles:{sliced:function(e,a){var t=e.Area_sqm;return 0==t?{fillColor:"white",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t<=2e4?{fillColor:"yellow",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t>2e4&&t<=4e4?{fillColor:"orange",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:{fillColor:"red",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}}},maxZoom:22,indexMaxZoom:5,interactive:!0,getFeatureId:function(e){return e.MUN_CODE},name:t}).addTo(map),toogleAreaStatsByMun=!0,groupAreaStats.addLayer(MUNtileLayer)),"Province"==a&&("Province_Falcata"==t&&(provRepoFalcata.addData(o),provRepoFalcata1=o),"Province_Gmelina"==t&&(provRepoGmelina.addData(o),provRepoGmelina1=o),"Province_Mangium"==t&&(provRepoMangium.addData(o),provRepoMangium1=o),"Province_Bagras"==t&&(provRepoBagras.addData(o),provRepoBagras1=o),PROVtileLayer=L.vectorGrid.slicer(o,{rendererFactory:L.canvas.tile,loadingControl:!0,vectorTileLayerStyles:{sliced:function(e,a){var t=e.Area_sqm;return 0==t?{fillColor:"white",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t<=2e4?{fillColor:"yellow",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t>2e4&&t<=4e4?{fillColor:"orange",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:{fillColor:"red",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}}},maxZoom:22,indexMaxZoom:5,interactive:!0,getFeatureId:function(e){return e.PRO_CODE},name:t}).addTo(map),toogleAreaStatsByMProv=!0,groupAreaStats.addLayer(PROVtileLayer)),console.log("added to map"),toogleAreaStats=!0,coverage_type=a,setTimeout(function(){$("#loadMe").modal("hide")},500)})}}function loadLayerStats(e,a,t){console.log("get from loaded geojson");var o=null;"Barangay"==a&&("Barangay_Falcata"==t&&(o=brgyRepoFalcata1),"Barangay_Gmelina"==t&&(o=brgyRepoGmelina1),"Barangay_Mangium"==t&&(o=brgyRepoMangium1),"Barangay_Bagras"==t&&(o=brgyRepoBagras1),BRGYtileLayer=L.vectorGrid.slicer(o,{rendererFactory:L.canvas.tile,loadingControl:!0,vectorTileLayerStyles:{sliced:function(e,a){var t=e.Area_sqm;return 0==t?{fillColor:"white",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t<=2e4?{fillColor:"yellow",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t>2e4&&t<=4e4?{fillColor:"orange",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:{fillColor:"red",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}}},maxZoom:22,indexMaxZoom:5,interactive:!0,getFeatureId:function(e){return e.BGY_CODE+"_"+e.MUN_CODE},name:t}),map.addLayer(BRGYtileLayer),toogleAreaStatsByBrgy=!0),"City/Municipality"==a&&("City/Municipality_Falcata"==t&&(o=munRepoFalcata1),"City/Municipality_Gmelina"==t&&(o=munRepoGmelina1),"City/Municipality_Mangium"==t&&(o=munRepoMangium1),"City/Municipality_Bagras"==t&&(o=munRepoBagras1),MUNtileLayer=L.vectorGrid.slicer(o,{rendererFactory:L.canvas.tile,loadingControl:!0,vectorTileLayerStyles:{sliced:function(e,a){var t=e.Area_sqm;return 0==t?{fillColor:"white",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t<=2e4?{fillColor:"yellow",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t>2e4&&t<=4e4?{fillColor:"orange",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:{fillColor:"red",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}}},maxZoom:22,indexMaxZoom:5,interactive:!0,getFeatureId:function(e){return e.MUN_CODE},name:t}),map.addLayer(MUNtileLayer),toogleAreaStatsByMun=!0),"Province"==a&&("Province_Falcata"==t&&(o=provRepoFalcata1),"Province_Gmelina"==t&&(o=provRepoGmelina1),"Province_Mangium"==t&&(o=provRepoMangium1),"Province_Bagras"==t&&(o=provRepoBagras1),PROVtileLayer=L.vectorGrid.slicer(o,{rendererFactory:L.canvas.tile,loadingControl:!0,vectorTileLayerStyles:{sliced:function(e,a){var t=e.Area_sqm;return 0==t?{fillColor:"white",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t<=2e4?{fillColor:"yellow",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:t>2e4&&t<=4e4?{fillColor:"orange",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}:{fillColor:"red",color:"black",weight:1,fill:!0,stroke:!0,fillOpacity:.8}}},maxZoom:22,indexMaxZoom:5,interactive:!0,getFeatureId:function(e){return e.PRO_CODE},name:t}),map.addLayer(PROVtileLayer),toogleAreaStatsByMProv=!0)}$(document).ready(function(){var e=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18,attribution:"Map data &copy; OpenStreetMap contributors",name:"Open Street Map",zIndex:0}),a=L.tileLayer("http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"],attribution:"Map data &copy; Google",name:"Google Sattelite",zIndex:0}),t=L.tileLayer("http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"],attribution:"Map data &copy; Google",name:"Google Hybrid",zIndex:0}).addTo(map),o=L.Control.loading({position:"topleft",separate:!0});map.addControl(o),L.control({position:"topright"}).onAdd=function(e){var a=L.DomUtil.create("div","maplegend");return a.innerHTML+="<h4>Trees</h4>",a.innerHTML+='<i style="background: skyblue"></i><span>Falcata</span><br>',a.innerHTML+='<i style="background: green"></i><span>Bagras</span><br>',a.innerHTML+='<i style="background: red"></i><span>Gmelina</span><br>',a.innerHTML+='<i style="background: orange"></i><span>Mangium</span><br>',a};var r=L.control.sidebar({container:"sidebar"}).addTo(map).open("home");r.on("content",function(e){switch(e.id){case"autopan":r.options.autopan=!0;break;default:r.options.autopan=!1}}),$("select#layers").treeMultiselect({allowBatchSelection:!1,showSectionOnSelected:!1,onChange:function(e,a,t){var o=null,r=null,l=null,i=null,n=null;if(t.length>0&&(console.log("removed",t),i=t[0].value,n=t[0].text),a.length>0&&(console.log("added",a),loadedLayers.includes(a[0])||loadedLayers.push(a[0]),o=a[0].value,r=a[0].text,l=a[0].section.split("/")),"trees"===o){var s=LAYERS.indexOf("stats");LAYERS.splice(s,1),groupAreaStats.hasLayer(BRGYtileLayer)&&map.removeLayer(BRGYtileLayer),groupAreaStats.hasLayer(MUNtileLayer)&&map.removeLayer(MUNtileLayer),groupAreaStats.hasLayer(PROVtileLayer)&&map.removeLayer(PROVtileLayer),"Bagras"===r&&0==toogleBAGRAS&&addBAGRAS(),"Bagras"===r&&1==toogleBAGRAS&&map.addLayer(BAGRAStileLayer),"Falcata"===r&&0==toogleFALCATA&&addFALCATA(),"Falcata"===r&&1==toogleFALCATA&&map.addLayer(FALCATAtileLayer),"Gmelina"===r&&0==toogleGMELINA&&addGMELINA(),"Gmelina"===r&&1==toogleGMELINA&&map.addLayer(GMELINAtileLayer),"Mangium"===r&&0==toogleMANGIUM&&addMANGIUM(),"Mangium"===r&&1==toogleMANGIUM&&map.addLayer(MANGIUMtileLayer)}if("stats"===o){for(var g=0;g<loadedLayers.length;g++){var m=loadedLayers[g].node;loadedLayers[g].id!=a[0].id?(console.log(loadedLayers[g].id,a[0].id),m.getElementsByTagName("input")[0].checked=!1,$('.item[data-key="'+loadedLayers[g].id+'"] span.remove-selected').click()):m.getElementsByTagName("input")[0].checked=!0}console.log("all selected",loadedLayers),groupAreaStats.hasLayer(BRGYtileLayer)&&map.removeLayer(BRGYtileLayer),groupAreaStats.hasLayer(MUNtileLayer)&&map.removeLayer(MUNtileLayer),groupAreaStats.hasLayer(PROVtileLayer)&&map.removeLayer(PROVtileLayer),groupTrees.hasLayer(FALCATAtileLayer)&&map.removeLayer(FALCATAtileLayer),groupTrees.hasLayer(GMELINAtileLayer)&&map.removeLayer(GMELINAtileLayer),groupTrees.hasLayer(MANGIUMtileLayer)&&map.removeLayer(MANGIUMtileLayer),groupTrees.hasLayer(BAGRAStileLayer)&&map.removeLayer(BAGRAStileLayer),-1==(s=LAYERS.indexOf("stats"))&&LAYERS.push("stats");var c=null,y=r+"_"+l[2],p=l[2];null==activeStatsLayer&&(activeStatsLayer=y),null==activeTreeName&&(activeTreeName="Nothing"),"Barangay_Falcata"==y&&(c=BRGY_FALCATA),"Barangay_Gmelina"==y&&(c=BRGY_GMELINA),"Barangay_Mangium"==y&&(c=BRGY_MANGIUM),"Barangay_Bagras"==y&&(console.log("bagras"),c=BRGY_BAGRAS),"City/Municipality_Falcata"==y&&(c=MUN_FALCATA),"City/Municipality_Gmelina"==y&&(c=MUN_GMELINA),"City/Municipality_Mangium"==y&&(c=MUN_MANGIUM),"City/Municipality_Bagras"==y&&(c=MUN_BAGRAS),"Province_Falcata"==y&&(c=PROV_FALCATA),"Province_Gmelina"==y&&(c=PROV_GMELINA),"Province_Mangium"==y&&(c=PROV_MANGIUM),"Province_Bagras"==y&&(c=PROV_BAGRAS),coverage_type==r&&y==activeStatsLayer||LAYERS.includes(y)||(toogleAreaStats=!1),y==activeStatsLayer||p==activeTreeName||LAYERS.includes(y)||(toogleAreaStatsByBrgy=!1,toogleAreaStatsByMun=!1,toogleAreaStatsByMProv=!1),console.log(y,activeStatsLayer),console.log(p,activeTreeName),LAYERS.includes(y)||LAYERS.push(y),activeStatsLayer=y,activeTreeName=p,console.log("toogleAreaStats",toogleAreaStats),console.log("toogleAreaStatsByBrgy",toogleAreaStatsByBrgy),console.log("toogleAreaStatsByMun",toogleAreaStatsByMun),console.log("toogleAreaStatsByMProv",toogleAreaStatsByMProv),0==toogleAreaStats&&"Barangay"==r&&0==toogleAreaStatsByBrgy&&addLayerStats(c,r,y),1==toogleAreaStatsByBrgy&&LAYERS.includes(y)&&"Barangay"==r&&(loadLayerStats(c,r,y),console.log("load again..",y)),0==toogleAreaStats&&"City/Municipality"==r&&0==toogleAreaStatsByMun&&addLayerStats(c,r,y),1==toogleAreaStatsByMun&&LAYERS.includes(y)&&"City/Municipality"==r&&(loadLayerStats(c,r,y),console.log("load again..",y)),0==toogleAreaStats&&"Province"==r&&0==toogleAreaStatsByMProv&&addLayerStats(c,r,y),1==toogleAreaStatsByMProv&&LAYERS.includes(y)&&"Province"==r&&(loadLayerStats(c,r,y),console.log("load again..",y))}"Falcata"===n&&map.removeLayer(FALCATAtileLayer),"Bagras"===n&&map.removeLayer(BAGRAStileLayer),"Gmelina"===n&&map.removeLayer(GMELINAtileLayer),"Mangium"===n&&map.removeLayer(MANGIUMtileLayer),"stats"===i&&("Barangay"==n&&(map.removeLayer(BRGYtileLayer),console.log("remove",n)),"City/Municipality"==n&&(map.removeLayer(MUNtileLayer),console.log("remove",n)),"Province"==n&&(map.removeLayer(PROVtileLayer),console.log("remove",n))),console.log(LAYERS)},startCollapsed:!0}),$("#base_map").multiselect({multiple:!1,onChange:function(o,r,l){var i=$(o).val();"osm"==i?(map.removeLayer(a),map.removeLayer(t),map.addLayer(e)):"googleHybrid"==i?(map.addLayer(t),map.removeLayer(a),map.removeLayer(e)):(map.addLayer(a),map.removeLayer(e),map.removeLayer(t))}}),$("#trees").val("").multiselect({multiple:!1,nonSelectedText:"Select Tree",onChange:function(e,a,t){var o=$(e).val();if(a){for(var r=0;r<loadedLayers.length;r++){loadedLayers[r].node.getElementsByTagName("input")[0].checked=!1,$('.item[data-key="'+loadedLayers[r].id+'"] span.remove-selected').click()}var l=LAYERS.indexOf("stats");LAYERS.splice(l,1),groupAreaStats.hasLayer(BRGYtileLayer)&&map.removeLayer(BRGYtileLayer),groupAreaStats.hasLayer(MUNtileLayer)&&map.removeLayer(MUNtileLayer),groupAreaStats.hasLayer(PROVtileLayer)&&map.removeLayer(PROVtileLayer),groupTrees.hasLayer(FALCATAtileLayer)&&map.removeLayer(FALCATAtileLayer),groupTrees.hasLayer(GMELINAtileLayer)&&map.removeLayer(GMELINAtileLayer),groupTrees.hasLayer(MANGIUMtileLayer)&&map.removeLayer(MANGIUMtileLayer),groupTrees.hasLayer(BAGRAStileLayer)&&map.removeLayer(BAGRAStileLayer),console.log(a),"Bagras"===o&&0==toogleBAGRAS&&addBAGRAS(),"Bagras"===o&&1==toogleBAGRAS&&map.addLayer(BAGRAStileLayer),"Falcata"===o&&0==toogleFALCATA&&addFALCATA(),"Falcata"===o&&1==toogleFALCATA&&map.addLayer(FALCATAtileLayer),"Gmelina"===o&&0==toogleGMELINA&&addGMELINA(),"Gmelina"===o&&1==toogleGMELINA&&map.addLayer(GMELINAtileLayer),"Mangium"===o&&0==toogleMANGIUM&&addMANGIUM(),"Mangium"===o&&1==toogleMANGIUM&&map.addLayer(MANGIUMtileLayer)}}});var l=document.getElementById("myChart"),i=new Chart(l,{type:"bar",data:{labels:[],datasets:[{label:"Area in sq. m.",data:[],backgroundColor:[]}]},options:{legend:{labels:{boxWidth:0}},title:{display:!0,text:""},scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}});map.on("click",function(e){highlight&&map.removeLayer(highlight);var a=e.latlng.lng,t=e.latlng.lat,o=leafletPip.pointInLayer([a,t],treesRepo,!0),r=null,l=activeStatsLayer;if("Barangay_Falcata"==l&&(r=leafletPip.pointInLayer([a,t],brgyRepoFalcata,!0)),"Barangay_Gmelina"==l&&(r=leafletPip.pointInLayer([a,t],brgyRepoGmelina,!0)),"Barangay_Mangium"==l&&(r=leafletPip.pointInLayer([a,t],brgyRepoMangium,!0)),"Barangay_Bagras"==l&&(r=leafletPip.pointInLayer([a,t],brgyRepoBagras,!0)),"City/Municipality_Falcata"==l&&(r=leafletPip.pointInLayer([a,t],munRepoFalcata,!0)),"City/Municipality_Gmelina"==l&&(r=leafletPip.pointInLayer([a,t],munRepoGmelina,!0)),"City/Municipality_Mangium"==l&&(r=leafletPip.pointInLayer([a,t],munRepoMangium,!0)),"City/Municipality_Bagras"==l&&(r=leafletPip.pointInLayer([a,t],munRepoBagras,!0)),"Province_Falcata"==l&&(r=leafletPip.pointInLayer([a,t],provRepoFalcata,!0)),"Province_Gmelina"==l&&(r=leafletPip.pointInLayer([a,t],provRepoGmelina,!0)),"Province_Mangium"==l&&(r=leafletPip.pointInLayer([a,t],provRepoMangium,!0)),"Province_Bagras"==l&&(r=leafletPip.pointInLayer([a,t],provRepoBagras,!0)),o[0]&&0==LAYERS.includes("stats")){var n=o[0].feature.properties,s=o[0].feature;highlight=new L.geoJson(s,{style:{color:"deepskyblue",fillColor:"deepskyblue"}});var g="<strong>Species:</strong> "+n.Species+"</br><strong>Location:</strong> "+n.Bgy_Name+", "+n.Mun_Name+", "+n.Pro_Name+", "+n.Reg_Name+"</br><strong>Area in square meters:</strong>"+n.Area_sqm.toFixed(2);map.on("popupclose",function(){map.removeLayer(highlight)}),setTimeout(function(){highlight.addTo(map),map.openPopup(g,e.latlng)},50)}if(r[0]&&LAYERS.includes("stats")){var m=r[0].feature.id;console.log(m);var c="";c=(n=r[0].feature.properties).Bgy_Name?n.Bgy_Name+", "+n.Mun_Name+", "+n.Pro_Name:n.Mun_Name?n.Mun_Name+", "+n.Pro_Name:n.Pro_Name;s=r[0].feature;highlight=new L.geoJson(s,{style:{color:"white",fillColor:"white"}});var y=[n.Area_sqm.toFixed(2)];i.data.datasets[0].data=y,i.data.datasets[0].backgroundColor="grey",i.data.labels[0]=n.Species,i.options.title.text=c,i.update(),setTimeout(function(){highlight.addTo(map),$("#chartMe").modal("show")},50),$("#chartMe").on("hidden.bs.modal",function(e){map.removeLayer(highlight)})}}),$("#btnOK").click(function(){r.open("query")})});